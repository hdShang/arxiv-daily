---
layout: default
title: SonicMoE: Accelerating MoE with IO and Tile-aware Optimizations
---

# SonicMoE: Accelerating MoE with IO and Tile-aware Optimizations

**arXiv**: [2512.14080v1](https://arxiv.org/abs/2512.14080) | [PDF](https://arxiv.org/pdf/2512.14080.pdf)

**ä½œè€…**: Wentao Guo, Mayank Mishra, Xinle Cheng, Ion Stoica, Tri Dao

**åˆ†ç±»**: cs.LG, cs.AI

**å‘å¸ƒæ—¥æœŸ**: 2025-12-16

---

## ðŸ’¡ ä¸€å¥è¯è¦ç‚¹

**æå‡ºSonicMoEä»¥è§£å†³ç»†ç²’åº¦é«˜ç¨€ç–MoEæ¨¡åž‹ä¸­çš„å†…å­˜å ç”¨é«˜ã€IOå¼€é”€å¤§å’Œè®¡ç®—æµªè´¹é—®é¢˜ã€‚**

ðŸŽ¯ **åŒ¹é…é¢†åŸŸ**: **å¼ºåŒ–å­¦ä¹ **

**å…³é”®è¯**: `æ··åˆä¸“å®¶æ¨¡åž‹` `å†…å­˜ä¼˜åŒ–` `GPUå†…æ ¸åŠ é€Ÿ` `ä»¤ç‰Œèˆå…¥` `è®¡ç®—æ•ˆçŽ‡` `æ¨¡åž‹è®­ç»ƒ` `ç¡¬ä»¶æ„ŸçŸ¥ä¼˜åŒ–` `ç¨€ç–è®¡ç®—`

## ðŸ“‹ æ ¸å¿ƒè¦ç‚¹

1. æ ¸å¿ƒé—®é¢˜ï¼šç»†ç²’åº¦MoEå› é«˜IOæˆæœ¬å¯¼è‡´å†…å­˜å ç”¨å¢žåŠ å’Œç¡¬ä»¶æ•ˆçŽ‡é™ä½Žï¼Œç¨€ç–MoEå› åˆ†ç»„GEMMå¡«å……é€ æˆè®¡ç®—æµªè´¹ã€‚
2. æ–¹æ³•è¦ç‚¹ï¼šæå‡ºå†…å­˜é«˜æ•ˆç®—æ³•å‡å°‘æ¿€æ´»ç¼“å­˜ï¼Œè®¾è®¡IOä¸Žè®¡ç®—é‡å çš„GPUå†…æ ¸ï¼Œå¹¶å¼•å…¥ä»¤ç‰Œèˆå…¥æ–¹æ³•æœ€å°åŒ–å¡«å……æµªè´¹ã€‚
3. å®žéªŒæˆ–æ•ˆæžœï¼šæ¿€æ´»å†…å­˜å‡å°‘45%ï¼Œè®¡ç®—åžåé‡æå‡1.86å€ï¼Œåœ¨é«˜ç¨€ç–è®¾ç½®ä¸‹å†…æ ¸æ‰§è¡Œæ—¶é—´é¢å¤–åŠ é€Ÿ1.16å€ã€‚

## ðŸ“ æ‘˜è¦ï¼ˆä¸­æ–‡ï¼‰

æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¨¡åž‹å·²æˆä¸ºæ‰©å±•è¯­è¨€æ¨¡åž‹è€Œä¸æ˜¾è‘—å¢žåŠ è®¡ç®—æˆæœ¬çš„äº‹å®žæž¶æž„ã€‚æœ€è¿‘çš„MoEæ¨¡åž‹æ˜¾ç¤ºå‡ºå‘é«˜ä¸“å®¶ç²’åº¦ï¼ˆè¾ƒå°çš„ä¸“å®¶ä¸­é—´ç»´åº¦ï¼‰å’Œæ›´é«˜ç¨€ç–æ€§ï¼ˆæ’å®šæ¿€æ´»ä¸“å®¶æ•°é‡ä½†æ€»ä¸“å®¶æ•°æ›´å¤šï¼‰çš„æ˜Žæ˜¾è¶‹åŠ¿ï¼Œè¿™æé«˜äº†æ¯FLOPçš„æ¨¡åž‹è´¨é‡ã€‚ç„¶è€Œï¼Œç»†ç²’åº¦MoEç”±äºŽæ›´é«˜çš„IOæˆæœ¬è€Œé¢ä¸´æ¿€æ´»å†…å­˜å ç”¨å¢žåŠ å’Œç¡¬ä»¶æ•ˆçŽ‡é™ä½Žçš„é—®é¢˜ï¼Œè€Œæ›´ç¨€ç–çš„MoEåˆ™å› åˆ†ç»„GEMMå†…æ ¸ä¸­çš„å¡«å……è€Œå¯¼è‡´è®¡ç®—æµªè´¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§å†…å­˜é«˜æ•ˆçš„ç®—æ³•æ¥è®¡ç®—MoEçš„å‰å‘å’ŒåŽå‘ä¼ é€’ï¼Œå¹¶ä¸ºåŽå‘ä¼ é€’æœ€å°åŒ–æ¿€æ´»ç¼“å­˜ã€‚æˆ‘ä»¬è¿˜è®¾è®¡äº†GPUå†…æ ¸ï¼Œå°†å†…å­˜IOä¸Žè®¡ç®—é‡å ï¼Œä½¿æ‰€æœ‰MoEæž¶æž„å—ç›Šã€‚æœ€åŽï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°é¢–çš„â€œä»¤ç‰Œèˆå…¥â€æ–¹æ³•ï¼Œä»¥æœ€å°åŒ–åˆ†ç»„GEMMå†…æ ¸ä¸­å¡«å……é€ æˆçš„è®¡ç®—æµªè´¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„æ–¹æ³•SonicMoEå°†æ¿€æ´»å†…å­˜å‡å°‘äº†45%ï¼Œå¹¶åœ¨Hopper GPUä¸Šå®žçŽ°äº†1.86å€çš„è®¡ç®—åžåé‡æå‡ï¼Œç›¸æ¯”äºŽScatterMoEçš„BF16 MoEå†…æ ¸ç”¨äºŽç»†ç²’åº¦7B MoEã€‚å…·ä½“æ¥è¯´ï¼ŒSonicMoEåœ¨64ä¸ªH100ä¸Šå®žçŽ°äº†æ¯å¤©2130äº¿ä»¤ç‰Œçš„è®­ç»ƒåžåé‡ï¼Œä¸ŽScatterMoEåœ¨96ä¸ªH100ä¸Šä½¿ç”¨lm-engineä»£ç åº“è¿›è¡Œ7B MoEæ¨¡åž‹è®­ç»ƒï¼ˆä½¿ç”¨FSDP-2ï¼‰çš„æ¯å¤©2250äº¿ä»¤ç‰Œåžåé‡ç›¸å½“ã€‚åœ¨é«˜MoEç¨€ç–æ€§è®¾ç½®ä¸‹ï¼Œæˆ‘ä»¬çš„ç“¦ç‰‡æ„ŸçŸ¥ä»¤ç‰Œèˆå…¥ç®—æ³•ç›¸æ¯”äºŽæ™®é€štop-Kè·¯ç”±ï¼Œåœ¨å†…æ ¸æ‰§è¡Œæ—¶é—´ä¸Šé¢å¤–å®žçŽ°äº†1.16å€çš„åŠ é€Ÿï¼ŒåŒæ—¶ä¿æŒç›¸ä¼¼çš„ä¸‹æ¸¸æ€§èƒ½ã€‚æˆ‘ä»¬å¼€æºäº†æ‰€æœ‰å†…æ ¸ï¼Œä»¥æ”¯æŒæ›´å¿«çš„MoEæ¨¡åž‹è®­ç»ƒã€‚

## ðŸ”¬ æ–¹æ³•è¯¦è§£

**é—®é¢˜å®šä¹‰**ï¼šè®ºæ–‡æ—¨åœ¨è§£å†³ç»†ç²’åº¦é«˜ç¨€ç–MoEæ¨¡åž‹ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šä¸€æ˜¯ç»†ç²’åº¦MoEå› æ¿€æ´»å†…å­˜å ç”¨é«˜å’ŒIOå¼€é”€å¤§å¯¼è‡´çš„ç¡¬ä»¶æ•ˆçŽ‡ä½Žä¸‹ï¼›äºŒæ˜¯ç¨€ç–MoEåœ¨åˆ†ç»„GEMMå†…æ ¸ä¸­å› å¡«å……é€ æˆçš„è®¡ç®—æµªè´¹ã€‚çŽ°æœ‰æ–¹æ³•å¦‚ScatterMoEåœ¨å¤„ç†è¿™äº›æŒ‘æˆ˜æ—¶å­˜åœ¨å†…å­˜ç¼“å­˜ä¸è¶³å’Œè®¡ç®—æ•ˆçŽ‡ç“¶é¢ˆã€‚

**æ ¸å¿ƒæ€è·¯**ï¼šé€šè¿‡ä¼˜åŒ–å†…å­˜ç®¡ç†å’Œè®¡ç®—æµç¨‹ï¼Œè®¾è®¡ä¸€ç§ç»¼åˆæ–¹æ¡ˆæ¥å‡å°‘æ¿€æ´»å†…å­˜ã€é‡å IOä¸Žè®¡ç®—ï¼Œå¹¶æœ€å°åŒ–åˆ†ç»„GEMMä¸­çš„å¡«å……æµªè´¹ï¼Œä»Žè€Œæå‡MoEæ¨¡åž‹çš„è®­ç»ƒæ•ˆçŽ‡å’Œåžåé‡ã€‚

**æŠ€æœ¯æ¡†æž¶**ï¼šæ•´ä½“æž¶æž„åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦æ¨¡å—ï¼šå†…å­˜é«˜æ•ˆç®—æ³•æ¨¡å—ï¼Œç”¨äºŽè®¡ç®—MoEçš„å‰å‘å’ŒåŽå‘ä¼ é€’å¹¶æœ€å°åŒ–æ¿€æ´»ç¼“å­˜ï¼›GPUå†…æ ¸ä¼˜åŒ–æ¨¡å—ï¼Œå®žçŽ°å†…å­˜IOä¸Žè®¡ç®—çš„é‡å ï¼›ä»¤ç‰Œèˆå…¥æ¨¡å—ï¼Œé€šè¿‡ç“¦ç‰‡æ„ŸçŸ¥æ–¹æ³•å‡å°‘åˆ†ç»„GEMMä¸­çš„å¡«å……ã€‚æµç¨‹ä¸Šï¼Œå…ˆåº”ç”¨å†…å­˜ç®—æ³•é™ä½Žå†…å­˜å ç”¨ï¼Œå†é€šè¿‡å†…æ ¸ä¼˜åŒ–åŠ é€Ÿè®¡ç®—ï¼Œæœ€åŽä½¿ç”¨ä»¤ç‰Œèˆå…¥è¿›ä¸€æ­¥å‡å°‘æµªè´¹ã€‚

**å…³é”®åˆ›æ–°**ï¼šæœ€é‡è¦çš„æŠ€æœ¯åˆ›æ–°æ˜¯â€œä»¤ç‰Œèˆå…¥â€æ–¹æ³•ï¼Œå®ƒé’ˆå¯¹åˆ†ç»„GEMMå†…æ ¸ä¸­çš„å¡«å……é—®é¢˜ï¼Œé€šè¿‡åŠ¨æ€è°ƒæ•´ä»¤ç‰Œåˆ†é…æ¥æœ€å°åŒ–è®¡ç®—æµªè´¹ï¼Œä¸ŽçŽ°æœ‰æ–¹æ³•å¦‚æ™®é€štop-Kè·¯ç”±ç›¸æ¯”ï¼Œæœ¬è´¨åŒºåˆ«åœ¨äºŽå…¶ç“¦ç‰‡æ„ŸçŸ¥çš„ä¼˜åŒ–ç­–ç•¥ï¼Œèƒ½æ›´æœ‰æ•ˆåœ°åˆ©ç”¨ç¡¬ä»¶èµ„æºã€‚

**å…³é”®è®¾è®¡**ï¼šåœ¨å†…å­˜é«˜æ•ˆç®—æ³•ä¸­ï¼Œå…³é”®è®¾è®¡åŒ…æ‹¬æœ€å°åŒ–æ¿€æ´»ç¼“å­˜çš„ç­–ç•¥ï¼Œä»¥å‡å°‘åŽå‘ä¼ é€’çš„å†…å­˜éœ€æ±‚ï¼›GPUå†…æ ¸è®¾è®¡ä¸­ï¼Œé‡‡ç”¨å¼‚æ­¥IOå’Œè®¡ç®—é‡å æŠ€æœ¯ï¼Œæå‡å¹¶è¡Œæ€§ï¼›ä»¤ç‰Œèˆå…¥æ–¹æ³•ä¸­ï¼Œå‚æ•°è®¾ç½®æ¶‰åŠç“¦ç‰‡å¤§å°å’Œèˆå…¥é˜ˆå€¼ï¼Œä»¥å¹³è¡¡è®¡ç®—æ•ˆçŽ‡å’Œæ¨¡åž‹æ€§èƒ½ï¼ŒæŸå¤±å‡½æ•°æˆ–ç½‘ç»œç»“æž„ç»†èŠ‚åœ¨è®ºæ–‡ä¸­æœªæ˜Žç¡®æŒ‡å®šï¼Œä½†æ•´ä½“åŸºäºŽMoEæž¶æž„è¿›è¡Œä¼˜åŒ–ã€‚

## ðŸ“Š å®žéªŒäº®ç‚¹

æœ€é‡è¦çš„å®žéªŒç»“æžœåŒ…æ‹¬ï¼šåœ¨ç»†ç²’åº¦7B MoEæ¨¡åž‹ä¸Šï¼ŒSonicMoEç›¸æ¯”ScatterMoEçš„BF16 MoEå†…æ ¸ï¼Œæ¿€æ´»å†…å­˜å‡å°‘45%ï¼Œè®¡ç®—åžåé‡æå‡1.86å€ï¼›åœ¨64ä¸ªH100 GPUä¸Šï¼Œè®­ç»ƒåžåé‡è¾¾åˆ°æ¯å¤©2130äº¿ä»¤ç‰Œï¼Œä¸ŽScatterMoEåœ¨96ä¸ªH100ä¸Šçš„2250äº¿ä»¤ç‰Œç›¸å½“ï¼›åœ¨é«˜ç¨€ç–è®¾ç½®ä¸‹ï¼Œä»¤ç‰Œèˆå…¥ç®—æ³•ç›¸æ¯”æ™®é€štop-Kè·¯ç”±ï¼Œå†…æ ¸æ‰§è¡Œæ—¶é—´é¢å¤–åŠ é€Ÿ1.16å€ï¼ŒåŒæ—¶ä¸‹æ¸¸æ€§èƒ½ä¿æŒç›¸ä¼¼ã€‚

## ðŸŽ¯ åº”ç”¨åœºæ™¯

è¯¥ç ”ç©¶ä¸»è¦åº”ç”¨äºŽå¤§è§„æ¨¡è¯­è¨€æ¨¡åž‹çš„è®­ç»ƒå’ŒæŽ¨ç†åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é«˜æ•ˆæ‰©å±•æ¨¡åž‹è§„æ¨¡è€Œä¸æ˜¾è‘—å¢žåŠ è®¡ç®—æˆæœ¬çš„é¢†åŸŸï¼Œå¦‚è‡ªç„¶è¯­è¨€å¤„ç†ã€æœºå™¨ç¿»è¯‘å’Œå¯¹è¯ç³»ç»Ÿã€‚å…¶å®žé™…ä»·å€¼åœ¨äºŽæ˜¾è‘—æå‡MoEæ¨¡åž‹çš„è®­ç»ƒé€Ÿåº¦å’Œèµ„æºåˆ©ç”¨çŽ‡ï¼Œé™ä½Žç¡¬ä»¶éœ€æ±‚ï¼Œæœªæ¥å¯èƒ½æŽ¨åŠ¨æ›´å¤æ‚AIæ¨¡åž‹çš„éƒ¨ç½²å’Œå•†ä¸šåŒ–åº”ç”¨ã€‚

## ðŸ“„ æ‘˜è¦ï¼ˆåŽŸæ–‡ï¼‰

> Mixture of Experts (MoE) models have emerged as the de facto architecture for scaling up language models without significantly increasing the computational cost. Recent MoE models demonstrate a clear trend towards high expert granularity (smaller expert intermediate dimension) and higher sparsity (constant number of activated experts with higher number of total experts), which improve model quality per FLOP. However, fine-grained MoEs suffer from increased activation memory footprint and reduced hardware efficiency due to higher IO costs, while sparser MoEs suffer from wasted computations due to padding in Grouped GEMM kernels. In response, we propose a memory-efficient algorithm to compute the forward and backward passes of MoEs with minimal activation caching for the backward pass. We also design GPU kernels that overlap memory IO with computation benefiting all MoE architectures. Finally, we propose a novel "token rounding" method that minimizes the wasted compute due to padding in Grouped GEMM kernels. As a result, our method SonicMoE reduces activation memory by 45% and achieves a 1.86x compute throughput improvement on Hopper GPUs compared to ScatterMoE's BF16 MoE kernel for a fine-grained 7B MoE. Concretely, SonicMoE on 64 H100s achieves a training throughput of 213 billion tokens per day comparable to ScatterMoE's 225 billion tokens per day on 96 H100s for a 7B MoE model training with FSDP-2 using the lm-engine codebase. Under high MoE sparsity settings, our tile-aware token rounding algorithm yields an additional 1.16x speedup on kernel execution time compared to vanilla top-$K$ routing while maintaining similar downstream performance. We open-source all our kernels to enable faster MoE model training.

