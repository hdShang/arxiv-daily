---
layout: default
title: SonicMoE: Accelerating MoE with IO and Tile-aware Optimizations
---

# SonicMoE: Accelerating MoE with IO and Tile-aware Optimizations

**arXiv**: [2512.14080v1](https://arxiv.org/abs/2512.14080) | [PDF](https://arxiv.org/pdf/2512.14080.pdf)

**ä½œè€…**: Wentao Guo, Mayank Mishra, Xinle Cheng, Ion Stoica, Tri Dao

**åˆ†ç±»**: cs.LG, cs.AI

**å‘å¸ƒæ—¥æœŸ**: 2025-12-16

---

## ðŸ’¡ ä¸€å¥è¯è¦ç‚¹

**æå‡ºSonicMoEç³»ç»Ÿï¼Œé€šè¿‡IOä¸ŽTileæ„ŸçŸ¥ä¼˜åŒ–åŠ é€Ÿæ··åˆä¸“å®¶æ¨¡åž‹è®­ç»ƒï¼Œè§£å†³å†…å­˜ä¸Žè®¡ç®—æ•ˆçŽ‡é—®é¢˜ã€‚**

ðŸŽ¯ **åŒ¹é…é¢†åŸŸ**: **å¼ºåŒ–å­¦ä¹ **

**å…³é”®è¯**: `æ··åˆä¸“å®¶æ¨¡åž‹` `GPUåŠ é€Ÿ` `å†…å­˜ä¼˜åŒ–` `è®¡ç®—æ•ˆçŽ‡` `ä»¤ç‰Œè·¯ç”±` `ç³»ç»Ÿä¼˜åŒ–` `å¤§è§„æ¨¡è®­ç»ƒ` `ç¨€ç–è®¡ç®—`

## ðŸ“‹ æ ¸å¿ƒè¦ç‚¹

1. æ ¸å¿ƒé—®é¢˜ï¼šç»†ç²’åº¦MoEå› é«˜IOæˆæœ¬å¯¼è‡´å†…å­˜å ç”¨å¤§ã€æ•ˆçŽ‡ä½Žï¼›ç¨€ç–MoEåœ¨åˆ†ç»„GEMMä¸­å› å¡«å……æµªè´¹è®¡ç®—èµ„æºã€‚
2. æ–¹æ³•è¦ç‚¹ï¼šè®¾è®¡å†…å­˜é«˜æ•ˆç®—æ³•å‡å°‘æ¿€æ´»ç¼“å­˜ï¼Œå¼€å‘IOä¸Žè®¡ç®—é‡å çš„GPUå†…æ ¸ï¼Œæå‡ºä»¤ç‰Œèˆå…¥æ–¹æ³•ä¼˜åŒ–å¡«å……è®¡ç®—ã€‚
3. å®žéªŒæˆ–æ•ˆæžœï¼šæ¿€æ´»å†…å­˜å‡å°‘45%ï¼Œè®¡ç®—åžåæå‡1.86å€ï¼Œè®­ç»ƒåžåè¾¾2130äº¿ä»¤ç‰Œ/å¤©ï¼Œç¨€ç–åœºæ™¯ä¸‹å†…æ ¸åŠ é€Ÿ1.16å€ã€‚

## ðŸ“ æ‘˜è¦ï¼ˆä¸­æ–‡ï¼‰

æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¨¡åž‹å·²æˆä¸ºæ‰©å±•è¯­è¨€æ¨¡åž‹è§„æ¨¡è€Œä¸æ˜¾è‘—å¢žåŠ è®¡ç®—æˆæœ¬çš„äº‹å®žæ ‡å‡†æž¶æž„ã€‚è¿‘æœŸMoEæ¨¡åž‹å‘ˆçŽ°å‡ºé«˜ä¸“å®¶ç²’åº¦ï¼ˆè¾ƒå°çš„ä¸“å®¶ä¸­é—´ç»´åº¦ï¼‰å’Œæ›´é«˜ç¨€ç–æ€§ï¼ˆæ¿€æ´»ä¸“å®¶æ•°é‡æ’å®šä½†æ€»ä¸“å®¶æ•°å¢žåŠ ï¼‰çš„æ˜Žæ˜¾è¶‹åŠ¿ï¼Œè¿™æé«˜äº†æ¯FLOPçš„æ¨¡åž‹è´¨é‡ã€‚ç„¶è€Œï¼Œç»†ç²’åº¦MoEç”±äºŽæ›´é«˜çš„IOæˆæœ¬å¯¼è‡´æ¿€æ´»å†…å­˜å ç”¨å¢žåŠ å’Œç¡¬ä»¶æ•ˆçŽ‡é™ä½Žï¼Œè€Œæ›´ç¨€ç–çš„MoEåˆ™å› åˆ†ç»„GEMMå†…æ ¸ä¸­çš„å¡«å……è€Œé­å—è®¡ç®—æµªè´¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æå‡ºä¸€ç§å†…å­˜é«˜æ•ˆç®—æ³•æ¥è®¡ç®—MoEçš„å‰å‘å’ŒåŽå‘ä¼ æ’­ï¼Œæœ€å°åŒ–åŽå‘ä¼ æ’­çš„æ¿€æ´»ç¼“å­˜ã€‚æˆ‘ä»¬è¿˜è®¾è®¡äº†GPUå†…æ ¸ï¼Œå°†å†…å­˜IOä¸Žè®¡ç®—é‡å ï¼Œä½¿æ‰€æœ‰MoEæž¶æž„å—ç›Šã€‚æœ€åŽï¼Œæˆ‘ä»¬æå‡ºä¸€ç§æ–°é¢–çš„â€œä»¤ç‰Œèˆå…¥â€æ–¹æ³•ï¼Œæœ€å°åŒ–åˆ†ç»„GEMMå†…æ ¸ä¸­å¡«å……é€ æˆçš„è®¡ç®—æµªè´¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„æ–¹æ³•SonicMoEåœ¨ç»†ç²’åº¦7B MoEä¸Šï¼Œç›¸æ¯”ScatterMoEçš„BF16 MoEå†…æ ¸ï¼Œå‡å°‘äº†45%çš„æ¿€æ´»å†…å­˜ï¼Œå¹¶åœ¨Hopper GPUä¸Šå®žçŽ°äº†1.86å€çš„è®¡ç®—åžåé‡æå‡ã€‚å…·ä½“è€Œè¨€ï¼Œåœ¨64ä¸ªH100ä¸Šï¼ŒSonicMoEå®žçŽ°äº†æ¯å¤©2130äº¿ä»¤ç‰Œçš„è®­ç»ƒåžåé‡ï¼Œä¸Žä½¿ç”¨lm-engineä»£ç åº“è¿›è¡ŒFSDP-2è®­ç»ƒçš„7B MoEæ¨¡åž‹åœ¨96ä¸ªH100ä¸ŠScatterMoEçš„2250äº¿ä»¤ç‰Œæ¯å¤©ç›¸å½“ã€‚åœ¨é«˜MoEç¨€ç–æ€§è®¾ç½®ä¸‹ï¼Œæˆ‘ä»¬çš„Tileæ„ŸçŸ¥ä»¤ç‰Œèˆå…¥ç®—æ³•ç›¸æ¯”æ™®é€štop-Kè·¯ç”±ï¼Œåœ¨ä¿æŒç›¸ä¼¼ä¸‹æ¸¸æ€§èƒ½çš„åŒæ—¶ï¼Œå®žçŽ°äº†é¢å¤–1.16å€çš„å†…æ ¸æ‰§è¡Œæ—¶é—´åŠ é€Ÿã€‚æˆ‘ä»¬å¼€æºæ‰€æœ‰å†…æ ¸ä»¥åŠ é€ŸMoEæ¨¡åž‹è®­ç»ƒã€‚

## ðŸ”¬ æ–¹æ³•è¯¦è§£

**é—®é¢˜å®šä¹‰**ï¼šè®ºæ–‡æ—¨åœ¨è§£å†³æ··åˆä¸“å®¶ï¼ˆMoEï¼‰æ¨¡åž‹è®­ç»ƒä¸­çš„ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼šç»†ç²’åº¦MoEå› é«˜ä¸“å®¶ç²’åº¦å¯¼è‡´æ¿€æ´»å†…å­˜å ç”¨å¤§å’ŒIOæˆæœ¬é«˜ï¼Œé™ä½Žç¡¬ä»¶æ•ˆçŽ‡ï¼›ç¨€ç–MoEåœ¨åˆ†ç»„GEMMï¼ˆé€šç”¨çŸ©é˜µä¹˜æ³•ï¼‰å†…æ ¸ä¸­å› å¡«å……ï¼ˆpaddingï¼‰é€ æˆè®¡ç®—æµªè´¹ï¼Œå½±å“è®­ç»ƒé€Ÿåº¦ã€‚çŽ°æœ‰æ–¹æ³•å¦‚ScatterMoEåœ¨å¤„ç†è¿™äº›æŒ‘æˆ˜æ—¶å­˜åœ¨å†…å­˜å¼€é”€å¤§å’Œè®¡ç®—æ•ˆçŽ‡ä½Žçš„ç—›ç‚¹ã€‚

**æ ¸å¿ƒæ€è·¯**ï¼šè®ºæ–‡çš„æ ¸å¿ƒæ€è·¯æ˜¯é€šè¿‡ç³»ç»Ÿçº§ä¼˜åŒ–æ¥å¹³è¡¡MoEæ¨¡åž‹çš„æ•ˆçŽ‡ä¸Žæ€§èƒ½ã€‚é’ˆå¯¹å†…å­˜é—®é¢˜ï¼Œè®¾è®¡æœ€å°åŒ–æ¿€æ´»ç¼“å­˜çš„ç®—æ³•ï¼›é’ˆå¯¹è®¡ç®—æµªè´¹ï¼Œæå‡ºä»¤ç‰Œèˆå…¥æ–¹æ³•å‡å°‘å¡«å……ï¼›åŒæ—¶ï¼Œåˆ©ç”¨GPUå†…æ ¸å®žçŽ°IOä¸Žè®¡ç®—é‡å ï¼Œæå‡æ•´ä½“åžåé‡ã€‚è¿™ç§è®¾è®¡åŸºäºŽå¯¹MoEæž¶æž„è¶‹åŠ¿ï¼ˆé«˜ç²’åº¦ã€é«˜ç¨€ç–æ€§ï¼‰çš„æ·±å…¥åˆ†æžï¼Œæ—¨åœ¨ç›´æŽ¥è§£å†³ç¡¬ä»¶ç“¶é¢ˆã€‚

**æŠ€æœ¯æ¡†æž¶**ï¼šæ•´ä½“æž¶æž„åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦æ¨¡å—ï¼šå†…å­˜é«˜æ•ˆçš„å‰å‘-åŽå‘ä¼ æ’­ç®—æ³•ã€IOä¸Žè®¡ç®—é‡å çš„GPUå†…æ ¸ä¼˜åŒ–ã€ä»¥åŠTileæ„ŸçŸ¥çš„ä»¤ç‰Œèˆå…¥ç®—æ³•ã€‚æµç¨‹ä¸Šï¼Œé¦–å…ˆåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åº”ç”¨ç®—æ³•å‡å°‘æ¿€æ´»ç¼“å­˜ï¼Œç„¶åŽé€šè¿‡å†…æ ¸ä¼˜åŒ–å¹¶è¡Œå¤„ç†IOå’Œè®¡ç®—ï¼Œæœ€åŽåœ¨è·¯ç”±é˜¶æ®µä½¿ç”¨ä»¤ç‰Œèˆå…¥åŠ¨æ€è°ƒæ•´ä»¤ç‰Œåˆ†é…ï¼Œæœ€å°åŒ–åˆ†ç»„GEMMä¸­çš„å¡«å……æ“ä½œã€‚

**å…³é”®åˆ›æ–°**ï¼šæœ€é‡è¦çš„æŠ€æœ¯åˆ›æ–°æ˜¯ä»¤ç‰Œèˆå…¥æ–¹æ³•ï¼Œå®ƒåŠ¨æ€è°ƒæ•´æ¿€æ´»ä¸“å®¶æ•°é‡ä»¥å‡å°‘å¡«å……ï¼Œä¸ŽçŽ°æœ‰é™æ€top-Kè·¯ç”±ç›¸æ¯”ï¼Œæœ¬è´¨åŒºåˆ«åœ¨äºŽè‡ªé€‚åº”ä¼˜åŒ–è®¡ç®—å›¾ç»“æž„ã€‚æ­¤å¤–ï¼ŒIOä¸Žè®¡ç®—é‡å çš„å†…æ ¸è®¾è®¡æ˜¯ç³»ç»Ÿçº§åˆ›æ–°ï¼Œæ˜¾è‘—æå‡GPUåˆ©ç”¨çŽ‡ã€‚è¿™äº›åˆ›æ–°ç›´æŽ¥é’ˆå¯¹MoEè®­ç»ƒä¸­çš„å†…å­˜å’Œè®¡ç®—ç“¶é¢ˆï¼Œå…·æœ‰æ™®é€‚æ€§ã€‚

**å…³é”®è®¾è®¡**ï¼šå…³é”®è®¾è®¡åŒ…æ‹¬ï¼šå†…å­˜é«˜æ•ˆç®—æ³•é€šè¿‡æ™ºèƒ½ç¼“å­˜ç­–ç•¥å‡å°‘æ¿€æ´»å­˜å‚¨ï¼›GPUå†…æ ¸åŸºäºŽHopperæž¶æž„ä¼˜åŒ–ï¼Œæ”¯æŒBF16ç²¾åº¦å’Œå¼‚æ­¥IOï¼›ä»¤ç‰Œèˆå…¥ç®—æ³•ç»“åˆTileæ„ŸçŸ¥ï¼ŒåŠ¨æ€è°ƒæ•´ä»¤ç‰Œåˆ°ä¸“å®¶çš„æ˜ å°„ï¼Œå‚æ•°è®¾ç½®ä¸Šå¯èƒ½æ¶‰åŠç¨€ç–é˜ˆå€¼å’Œèˆå…¥ç­–ç•¥ï¼Œä½†è®ºæ–‡æœªè¯¦ç»†è¯´æ˜ŽæŸå¤±å‡½æ•°æˆ–ç½‘ç»œç»“æž„å˜åŒ–ï¼Œä¸»è¦èšç„¦äºŽç³»ç»Ÿä¼˜åŒ–å±‚é¢ã€‚

## ðŸ“Š å®žéªŒäº®ç‚¹

æœ€é‡è¦çš„å®žéªŒç»“æžœåŒ…æ‹¬ï¼šåœ¨ç»†ç²’åº¦7B MoEä¸Šï¼ŒSonicMoEç›¸æ¯”ScatterMoEçš„BF16å†…æ ¸ï¼Œæ¿€æ´»å†…å­˜å‡å°‘45%ï¼Œè®¡ç®—åžåæå‡1.86å€ï¼›åœ¨64ä¸ªH100 GPUä¸Šï¼Œè®­ç»ƒåžåè¾¾åˆ°2130äº¿ä»¤ç‰Œ/å¤©ï¼Œä¸ŽScatterMoEåœ¨96ä¸ªH100ä¸Šçš„2250äº¿ä»¤ç‰Œ/å¤©ç›¸å½“ï¼›åœ¨é«˜ç¨€ç–è®¾ç½®ä¸‹ï¼Œä»¤ç‰Œèˆå…¥ç®—æ³•ç›¸æ¯”æ™®é€štop-Kè·¯ç”±ï¼Œå†…æ ¸æ‰§è¡Œæ—¶é—´åŠ é€Ÿ1.16å€ï¼ŒåŒæ—¶ä¸‹æ¸¸æ€§èƒ½ä¿æŒç›¸ä¼¼ã€‚è¿™äº›æ•°æ®åŸºäºŽHopper GPUå’Œlm-engineä»£ç åº“éªŒè¯ã€‚

## ðŸŽ¯ åº”ç”¨åœºæ™¯

è¯¥ç ”ç©¶ä¸»è¦åº”ç”¨äºŽå¤§è§„æ¨¡è¯­è¨€æ¨¡åž‹çš„è®­ç»ƒä¸ŽæŽ¨ç†åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é«˜æ•ˆæ‰©å±•æ¨¡åž‹å‚æ•°çš„MoEæž¶æž„ä¸­ã€‚æ½œåœ¨åº”ç”¨é¢†åŸŸåŒ…æ‹¬è‡ªç„¶è¯­è¨€å¤„ç†ã€AIåŠ©æ‰‹å’Œå†…å®¹ç”Ÿæˆç­‰ã€‚å®žé™…ä»·å€¼åœ¨äºŽæ˜¾è‘—é™ä½Žè®­ç»ƒæˆæœ¬å’Œæ—¶é—´ï¼Œæå‡ç¡¬ä»¶åˆ©ç”¨çŽ‡ï¼Œæœªæ¥å¯èƒ½æŽ¨åŠ¨æ›´å¤æ‚MoEæ¨¡åž‹çš„éƒ¨ç½²ï¼ŒåŠ é€ŸAIæ¨¡åž‹è§„æ¨¡åŒ–è¿›ç¨‹ã€‚

## ðŸ“„ æ‘˜è¦ï¼ˆåŽŸæ–‡ï¼‰

> Mixture of Experts (MoE) models have emerged as the de facto architecture for scaling up language models without significantly increasing the computational cost. Recent MoE models demonstrate a clear trend towards high expert granularity (smaller expert intermediate dimension) and higher sparsity (constant number of activated experts with higher number of total experts), which improve model quality per FLOP. However, fine-grained MoEs suffer from increased activation memory footprint and reduced hardware efficiency due to higher IO costs, while sparser MoEs suffer from wasted computations due to padding in Grouped GEMM kernels. In response, we propose a memory-efficient algorithm to compute the forward and backward passes of MoEs with minimal activation caching for the backward pass. We also design GPU kernels that overlap memory IO with computation benefiting all MoE architectures. Finally, we propose a novel "token rounding" method that minimizes the wasted compute due to padding in Grouped GEMM kernels. As a result, our method SonicMoE reduces activation memory by 45% and achieves a 1.86x compute throughput improvement on Hopper GPUs compared to ScatterMoE's BF16 MoE kernel for a fine-grained 7B MoE. Concretely, SonicMoE on 64 H100s achieves a training throughput of 213 billion tokens per day comparable to ScatterMoE's 225 billion tokens per day on 96 H100s for a 7B MoE model training with FSDP-2 using the lm-engine codebase. Under high MoE sparsity settings, our tile-aware token rounding algorithm yields an additional 1.16x speedup on kernel execution time compared to vanilla top-$K$ routing while maintaining similar downstream performance. We open-source all our kernels to enable faster MoE model training.

